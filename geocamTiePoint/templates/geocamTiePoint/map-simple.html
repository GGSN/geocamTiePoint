<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0}

      #toptable td {
        padding: 5px;
        font-weight: bold;
      }     
       .topbuttonleft {
            padding-top: 10px;
            padding-bottom: 10px;
            padding-left: 10px;
            float: left}
      .topbuttonright {
            padding-top: 10px;
            padding-bottom: 10px;
            padding-left: 10px;
            float: right}      
      #map_canvas {
        width:100%
        height:100%
      }
      #map_canvas2 {
        height:100%
        width:100%
      }
      #shelf_left {position:fixed; 
              top:20px; left:20px; 
              height:50px;width:600px;
              background:white;opacity:0.7; float:left}
      #shelf_right {position:fixed; 
              top:20px; left:20px; 
              height:50px;width:600px;
              background:white;opacity:0.7; float:right}
      #draggableLft{width:30px; height:30px; z-index:1000000; }
      #draggableRgt{width:30px; height:30px; z-index:1000000; }
      #saveButton{ position:fixed; 
                  top:20px; left:20px;float:left}

    </style>
    <script type="text/javascript"
      src="http://maps.googleapis.com/maps/api/js?key=AIzaSyBTKvfgQ562FIwKbSvddIqq2vqEJL9673M&sensor=false">
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?sensor=false&libraries=places"></script>
    <script src="http://gmaps-utility-library.googlecode.com/svn/trunk/markermanager/release/src/markermanager.js"></script>
<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
    <script type="text/javascript">
     
      //OVERLAY
      var overlay;
      //USGSOverlay.prototype = new google.maps.OverlayView();

      //MARKERS
      var redMarkers = ['images/numbers/r1.png', 'images/numbers/r2.png', 
                      'images/numbers/r3.png', 'images/numbers/r4.png', 
                      'images/numbers/r5.png', 'images/numbers/r6.png',
                      'images/numbers/r7.png', 'images/numbers/r8.png',
                      'images/numbers/r9.png'];

      var blueMarkers = ['images/numbers/b1.png', 'images/numbers/b2.png', 
                       'images/numbers/b3.png', 'images/numbers/b4.png', 
                       'images/numbers/b5.png', 'images/numbers/b6.png',
                       'images/numbers/b7.png', 'images/numbers/b8.png',
                       'images/numbers/b9.png'];
          
      //SF MAP QUAD TREE
      var sfMapTypeOptions = {
        getTileUrl: function(coord, zoom) {
          var normalizedCoord = getNormalizedCoord(coord, zoom);
          if(!normalizedCoord) {
            return null;
          }
          var bound = Math.pow(2,zoom);
          return "/Users/yeonjinlee/geocamTiePoint/geocamTiePoint/static/sf_1920"+
                 "/" + zoom + "/" + normalizedCoord.x + "/" +
                 (bound - normalizedCoord.y - 1) + ".jpg";
        },
        tileSize: new google.maps.Size(256, 256),
        maxZoom: 3,
        minZoom: 0,
        radius: 1738000,
        name: "SF1920"
      };

      var sfMapType = new google.maps.ImageMapType(sfMapTypeOptions);      
      
      //MARKER MANAGER
      var mgr;
      var allmarkers= [];    
      var allmarkers2= [];    
 
      function initialize() {
        var myLatLng = new google.maps.LatLng(37.7548025158956, -122.45542151199643);

        //MAP 1  
        var myOptions = {
          center: myLatLng,
          zoom: 11,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("map_canvas"),
            myOptions);

        overlay = new google.maps.OverlayView();
        overlay.draw = function() {};
        overlay.setMap(map);
      
        var swBound = new google.maps.LatLng(37.681819, -122.517132);
        var neBound = new google.maps.LatLng(37.800471, -122.405608);
        var bounds = new google.maps.LatLngBounds(swBound,neBound);
      
        //DRAG AND DROP ICONS
        var iconImg = redMarkers[0];
        $(document).ready(function() {
        $("#draggableLft").draggable({helper: 'clone',
        stop: function(e) {
                var point=new google.maps.Point(e.pageX,e.pageY);
                var ll=overlay.getProjection().fromContainerPixelToLatLng(point);
                placeMarker(allmarkers,iconImg,ll,map); //placeMarker(ll);
              }
        });
        });

        var iconImg2 = blueMarkers[0];
        $(document).ready(function() {
        $("#draggableRgt").draggable({helper: 'clone',
        stop: function(e) {
                var point=new google.maps.Point(e.pageX,e.pageY);
                var ll=overlay.getProjection().fromContainerPixelToLatLng(point);
                placeMarker(allmarkers2,iconImg2,ll,map2); //placeMarker(ll);
              }
        });
        });

        //MAP 2
         var myOptions2 = {
          center: myLatLng,
          zoom: 1,
          streetViewControl: false,
          mapTypeControlOptions: {
            mapTypeId: ["sf1920"]
          }
        };

        var map2 = new google.maps.Map(document.getElementById("map_canvas2"),
            myOptions2);
        map2.mapTypes.set('sf1920', sfMapType);
        map2.setMapTypeId('sf1920');


        //SEARCHBAR
        var input = document.getElementById('searchTextField');
        var autocomplete = new google.maps.places.Autocomplete(input);

        autocomplete.bindTo('bounds',map);

        var infowindow = new google.maps.InfoWindow();
        var marker = new google.maps.Marker({
            map: map
        });

        google.maps.event.addListener(autocomplete, 'place_changed',function() {
          infowindow.close();
          var place = autocomplete.getPlace();
          if (place.geometry.viewport) {
            map.fitBounds(place.geometry.viewport)
          } else {
            map.setCenter(place.geometry.location);
            map.setZoom(17);  
          }
          
          var address = '';
          if (place.address_components) {
            address = [(place.address_components[0] &&
                        place.address_components[0].short_name || ''),
                        (place.address_components[1] &&
                        place.address_components[1].short_name || ''),
                        (place.address_components[2] &&
                        place.address_components[2].short_name || '')
                      ].join(' ');
          }

          infowindow.setContent('<div><strong>' + place.name + '</strong><br>' + address);
          infowindow.open(map, marker);
        });

        // Sets a listener on a radio button to change the filter type on Places
        // Autocomplete.
        function setupClickListener(id, types) {
          var radioButton = document.getElementById(id);
          google.maps.event.addDomListener(radioButton, 'click', function() {
          autocomplete.setTypes(types);
          });
        }

        setupClickListener('changetype-all', []);
        setupClickListener('changetype-establishment', ['establishment']);
        setupClickListener('changetype-geocode', ['geocode']);



        var image = 'image/icon24.png';
      }

      function placeMarker2(location) {
        var marker = new google.maps.Marker({
          position: location,
          map: map,
          draggable: true,
        });

        markers.push(marker);
      }

      function placeMarker(markers, iconImg, position, map) {
        var marker = new google.maps.Marker({
          position: position,
          map: map,
          draggable: true,
          icon: iconImg
        });

        markers.push(marker);
      }
      
      function getNormalizedCoord(coord, zoom) {
        var y = coord.y;
        var x = coord.x;

        var tileRange = 1 << zoom;

        if (y < 0 || y >= tileRange) {
          return null;
        }
     
        if (x < 0 || x >= tileRange) {
          x = (x % tileRange + tileRange) % tileRange;
        }

        return {
          x: x,
          y: y
        };
      }

      
      function clearMarkers(){
        if (allmarkers) {
          for (var i = 0; i < allmarkers.length; i++ ) {
            allmarkers[i].setMap(null);
          }
        }
      }

      function clearMarkers2(){
        if (allmarkers2) {
          for (var i = 0; i < allmarkers2.length; i++ ) {
            allmarkers2[i].setMap(null);
          }
        }
      }

      function loadScript() {
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.src = "http://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&sensor=TRUE_OR_FALSE&callback=initialize";
        document.body.appendChild(script);
      }
    
    google.maps.event.addDomListener(window,'load',initialize); 
    window.onload = loadScript();
    </script>
  </head>

  <body onload="initialize()">
    <div>
      <input id="searchTextField" type="text" size="50">
      <input type="radio" name="type" id="changetype-all" checked="checked">
      <label for="changetype-all">All</label>

      <input type="radio" name="type" id="changetype-establishment">
      <label for="changetype-establishment">Establishments</label>

      <input type="radio" name="type" id="changetype-geocode">
      <label for="changetype-geocode">Geocodes</lable>
    </div>

    <br>

    <div id="map_canvas" style="width:50%; height:50%; float:left"></div>
    <div id="map_canvas2" style="width:50%; height:50%; float:left "></div>

    <div id="toptable">
        <div class="topbuttonleft">
            <input type = "button" onclick="clearMarkers()" value="clear all markers"/>
        </div>
        <div class="topbuttonleft">
          <img id="draggableLft" src='images/numbers/r1.png'/>
        </div>
        <div class="topbuttonleft">
          <img id="draggableLft" src='images/numbers/r2.png'/>
        </div>
        <div class="topbuttonleft">
          <img id="draggableLft" src='images/numbers/r3.png'/>
        </div>
        <div class="topbuttonleft">
          <img id="draggableLft" src='images/numbers/r4.png'/>
        </div>

        <div class="topbuttonright">
            <input type = "button" onclick="clearMarkers2()" value="clear all markers"/>
        </div>
        <div class="topbuttonright">
          <img id="draggableRgt" src='images/numbers/b4.png'/>
        </div>
        <div class="topbuttonright">
          <img id="draggableRgt" src='images/numbers/b3.png'/>
        </div>
        <div class="topbuttonright">
          <img id="draggableRgt" src='images/numbers/b2.png'/>
        </div>
        <div class="topbuttonright">
          <img id="draggableRgt" src='images/numbers/b1.png'/>
        </div>

    </div>
    <div id = "saveButton">
      <input type = "button" onclick="saveOverlayedImg()" value="export & save" />
    </div>
  </body>

</html>
